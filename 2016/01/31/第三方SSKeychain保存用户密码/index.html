<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>第三方SSKeychain保存用户密码 | zhz blogs</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">第三方SSKeychain保存用户密码</h1><a id="logo" href="/.">zhz blogs</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">第三方SSKeychain保存用户密码</h1><div class="post-meta">Jan 31, 2016<span> | </span><span class="category"><a href="/categories/ios平台/">ios平台</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><p> UDID(-[UIDevice uniqueIdentifier])在iOS7.0被<code>禁用</code>，一般使用<code>UUID来作为设备的唯一标识</code>。</p>
 <s>获取到UUID后，如果用NSUserDefaults存储，当程序被卸载后重装时，再获得的UUID和之前就不同了。<br> 使用keychain存储可以保证程序卸载重装时，UUID不变。但当刷机或者升级系统后，UUID还是会改变的。</s>

<p> 测试发现:<br>  程序一(test1):<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">NSLog(@&quot;--%@--&quot;, [UIDevice currentDevice].identifierForVendor.UUIDString);</div><div class="line">//模拟器6 8.1:   547B1AE8-483D-4740-A668-AC600A6EA7F4</div><div class="line">//卸载后重新运行: 547B1AE8-483D-4740-A668-AC600A6EA7F4</div><div class="line">//模拟器6 9.2:  4572DE5F-5E98-4C1A-A9FD-E32A12530469</div></pre></td></tr></table></figure></p>
<p> 程序二(test2):<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">NSLog(@&quot;--%@--&quot;, [UIDevice currentDevice].identifierForVendor.UUIDString);</div><div class="line">//模拟器6 8.1:   547B1AE8-483D-4740-A668-AC600A6EA7F4</div><div class="line">//卸载后重新运行: 547B1AE8-483D-4740-A668-AC600A6EA7F4</div><div class="line">//模拟器6 9.2:  4572DE5F-5E98-4C1A-A9FD-E32A12530469</div></pre></td></tr></table></figure></p>
<h1 id="1-keychain的功能"><a href="#1-keychain的功能" class="headerlink" title="1. keychain的功能"></a>1. keychain的功能</h1><p> <hr color="blue"><br>   <big> keychain的主要功能就是帮助用户<code>安全地记住他的密码</code>，keychain保存的密码文件都是<code>经过加密</code>的，其它人不能直接通过打开keychain的文件获得保存在keychain中的密码. </big></p>
<p> 苹果已经有现成的类封装好了keychain, <code>KeychainItemWrapper.h</code>和<code>KeychainItemWrapper.m</code>文件,可以在GenericKeychain实例里找到。</p>
<blockquote>
<p><a href="https://developer.apple.com/library/ios/documentation/Security/Conceptual/keychainServConcepts/01introduction/introduction.html#//apple_ref/doc/uid/TP30000897" target="_blank" rel="external">苹果官方：Keychain Services Programming Guide</a></p>
<p><a href="https://developer.apple.com/library/ios/documentation/Security/Reference/keychainservices/index.html#//apple_ref/doc/constant_group/Keychain_Import_Export_Options" target="_blank" rel="external">苹果官方： Keychain Services Reference</a></p>
<p><a href="https://developer.apple.com/library/ios/samplecode/GenericKeychain/Listings/Classes_DetailViewController_h.html#//apple_ref/doc/uid/DTS40007797-Classes_DetailViewController_h-DontLinkElementID_5" target="_blank" rel="external">苹果官方代码</a></p>
</blockquote>
<p> &gt;</p>
<blockquote>
<p>A keychain is an encrypted container that holds passwords for multiple applications and secure services. Keychains are secure storage containers, which means that when the keychain is locked, no one can access its protected contents. In OS X, users can unlock a keychain—thus providing trusted applications access to the contents—by entering a single master password. In iOS, each application always has access to its own keychain items; the user is never asked to unlock the keychain. Whereas in OS X any application can access any keychain item provided the user gives permission, in iOS an application can access only its own keychain items.</p>
</blockquote>
<p> 钥匙链是一个加密的容器，它保存了多个程序和安全服务的密码。钥匙链是一个安全的存储容器，这意味着没有应用程序或服务在它锁住的情况下，可以访问它的内容。在Mac OS X下，用户可以解锁钥匙链，因此可以通过输入主密码的形式提供给信任的应用程序访问里面的内容。在iOS中，每个应用程序只能访问自己的钥匙链项；用户不能解锁钥匙链。相反在Mac OS X里，用户给予了许可，每个应用程序都能访问任何一个钥匙链项。在iOS里，一个应用程序只能访问自己的钥匙链项。</p>
<blockquote>
<p>Note： On iPhone, Keychain rights depend on the provisioning profile used to sign your application. Be sure to consistently use the same provisioning profile across different versions of your application.</p>
</blockquote>
<p> 注意：在iPhone中，钥匙链依赖于 provisioning profile 文件来标识你的应用程序。确保应用程序在不同版本中一贯的使用同一个 provisioning profile 文件</p>
<blockquote>
<p>In iOS,there is a single keychain accessible to applications. Although it stores the keychain items of all the applications on the system, an application can access only its own keychain items (with the possible exception of a keychain item for which the application that created it obtained a persistent reference).</p>
</blockquote>
<p> 在iOS里，有一个单独的钥匙链供应用程序访问。尽管他存储了系统里全部应用程序的钥匙链项，一个应用程序只能并且仅能访问它自己的钥匙链项（包括因为应用程序创建包含了一个持久的引用二引发的可能的钥匙链项异常）</p>
<blockquote>
<p>Structure of a Keychain<br> Each keychain can contain any number of keychain items. Each keychain item contains data plus a set of attributes. For a keychain item that needs protection, such as a password or private key (a string of bytes used to encrypt or decrypt data), the data is encrypted and protected by the keychain. For keychain items that do not need protection, such as certificates, the data is not encrypted.</p>
</blockquote>
<p> 钥匙链结构<br> 每一个钥匙链可以包含任意数量的钥匙链项。每个钥匙链项包含数据加上一些属性集。对一个钥匙链项来说需要进行保护，比如像一个密码或这个私有键（加密或者揭秘的二进制数据字符串），数据被钥匙链加密和保护。对多个钥匙链项来说不需要保护，比如像证书，它的数据是不加密的。</p>
<blockquote>
<p>The iOS gives an application access to only its own keychain items.</p>
</blockquote>
<p> 在iOS中，仅给一个用程序访问它自己的钥匙项权限。</p>
<blockquote>
<p>The iOS Keychain Services API uses a different paradigm. This API has a single function (SecItemAdd) for adding an item to a keychain.</p>
</blockquote>
<p> 在iOS钥匙链服务API使用了一个不同的范式（相对于Mac OS X）。这个API有一个单独的函数（SecItemAdd）来添加一个钥匙链项。</p>
<blockquote>
<p>In iOS, you call the SecItemCopyMatching function to find a keychain item owned by your application. In this case there’s only one keychain and the user is never prompted to unlock it.</p>
</blockquote>
<p> 在iOS中，你调用SecItemCopyMatching函数来查找你应用程序自己的钥匙链项目。在这种情况下，仅有一个钥匙链并且用户不需要被提示来解锁它（相对于Mac OS X）。</p>
 <big>iOS钥匙链服务搜索字典</big>

<p> 在iOS，钥匙链服务使用键值对字典方式来制定钥匙链项的属性，这样你就能查找或者创建。</p>
<p> 经典的搜索字典组成：</p>
<p> class key：用来指定要搜索的钥匙链项的类型（比如，互联网密码 或者密码密钥）。</p>
<p> 一个或多个键值对来指定匹配属性数据（比如标签或者创建日期）</p>
<p> 一个或多个搜索键值对，用来指定值来精确搜索，比如发行证书或者邮件地址来匹配。</p>
<p> 一个返回值键值对，来指定你想要的数据（比如。一个字典或者是一个偏好引用）。<br> 什么样的属性值被指定，取决于你要搜索的钥匙链项的类型。举例，如果你指定键位kSecClass的值为kSecClassGenericPassword，然后你可以指定创建时间的值或这个修改时间的值，但是不能指定主题或发行者（这个被用于证书）。</p>
<p> 举例，如果你想执行一个对AppStore账户名为’ImaUser’密码不敏感情况的搜索,你可以在SecItemCopyMatching函数，使用上面表格中的键值对。</p>
<p> kSecReturnData键是函数返回钥匙链项的数据，如果你想得到键值对的值，你需要使用kSecReturnAttributes返回类型键并且值为kCFBooleanTrue.</p>
<h1 id="2-iOS中使用keychain和userdefaults保存数据的对比"><a href="#2-iOS中使用keychain和userdefaults保存数据的对比" class="headerlink" title="2. iOS中使用keychain和userdefaults保存数据的对比"></a>2. iOS中使用keychain和userdefaults保存数据的对比</h1><p> <hr color="red"><br> <big><font color="red">1.  <code>userdefault</code>适合保存一些<code>轻量级的数据</code>，使用userdefault保存的数据<code>加载的时候要快一些</code>，数据以<code>明文</code>的形式保存在<code>.plist文件</code>中，不适合用来保存密码信息。文件的位置是<code>Library/Application Support/iPhone Simulator/模拟器版本/Applications/应用对应的数字/Library/Preference/.plist</code>文件</font></big></p>
<pre><code>&lt;big&gt;&lt;font color=&quot;red&quot;&gt;2. `keychain`采用的是将`数据加密之后再保存到本地`的，这样对数据而言有`更高的安全性`，适合`保存密码`之类的数据。数据保存的目录是`Library/Application Support/iPhone Simulator/模拟器版本/Library/Keychains/`&lt;/font&gt;&lt;/big&gt;
</code></pre><h1 id="3-SSKeychain的使用"><a href="#3-SSKeychain的使用" class="headerlink" title="3. SSKeychain的使用"></a>3. SSKeychain的使用</h1><p> <hr color="orange"><br> github地址: <a href="https://github.com/samsoffes/sskeychain" target="_blank" rel="external">https://github.com/samsoffes/sskeychain</a></p>
<p> SSKeychain对apple安全框架API进行了简单封装，支持对存储在钥匙串中密码、账户进行访问，包括读取、删除和设置；</p>
<h2 id="在工程中加入SSKeyChain"><a href="#在工程中加入SSKeyChain" class="headerlink" title="在工程中加入SSKeyChain"></a>在工程中加入SSKeyChain</h2><p> 方法一:  手动添加<br>         在工程中加入<code>Security.framework</code>框架。<br>         把<code>SSKeychain.h</code>和<code>SSKeychain.m</code>加到项目文件夹。</p>
<p> 方法二: 使用第三方管理工具<br> <code>pod &#39;SSKeychain&#39;, &#39;~&gt; 1.3.1&#39;</code></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p> SSKeyChain使用起来非常的简单, 方法也不多<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//获取所有账号</div><div class="line">+ (NSArray *)allAccounts;</div><div class="line"></div><div class="line">//获取某个服务下的所有账号</div><div class="line">+ (NSArray *)accountsForService:(NSString *)serviceName;</div><div class="line"></div><div class="line">//设置特定服务下的给定账号的密码</div><div class="line">+ (BOOL)setPassword:(NSString *)password forService:(NSString *)serviceName account:(NSString *)account;</div><div class="line"></div><div class="line">//获取某个服务下的某个账号的密码</div><div class="line">+ (NSString *)passwordForService:(NSString *)serviceName account:(NSString *)account;</div><div class="line"></div><div class="line">//删除某个服务下的某个账号的密码</div><div class="line">+ (BOOL)deletePasswordForService:(NSString *)serviceName account:(NSString *)account;</div></pre></td></tr></table></figure></p>
 <big><font color="red">注意:</font></big>

<ol>
<li><p>以上方法中的<code>serviceName</code> 和 <code>account</code> 参数应该是一致的这样才能保证真确的操作, 建议使用<code>宏定义</code> 或者 <code>static NSString *kServiceName = @&quot;ServiceName&quot;;</code></p>
</li>
<li><p>如果你保存密码失败，处理方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">NSError *error = nil;  </div><div class="line">NSString *password = [SSKeychain passwordForService:@&quot;自定义的服务器名&quot; account:@&quot;账号&quot; error:&amp;error];  </div><div class="line">  </div><div class="line">if ([error code] == SSKeychainErrorNotFound) &#123;  </div><div class="line">    NSLog(@&quot;该账户没有储存密码&quot;); </div><div class="line">    //you should do something more sophisticated </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p> 参考文档: </p>
<ol>
<li><a href="https://github.com/samsoffes/sskeychain" target="_blank" rel="external">https://github.com/samsoffes/sskeychain</a></li>
<li><a href="http://www.ithao123.cn/content-2407927.html" target="_blank" rel="external">http://www.ithao123.cn/content-2407927.html</a></li>
<li><a href="https://developer.apple.com/library/ios/documentation/Security/Reference/keychainservices/index.html#//apple_ref/doc/constant_group/Keychain_Import_Export_Options" target="_blank" rel="external">https://developer.apple.com/library/ios/documentation/Security/Reference/keychainservices/index.html#//apple_ref/doc/constant_group/Keychain_Import_Export_Options</a></li>
<li><p><a href="http://www.kanyinqing.com/read/it/other/445654.html" target="_blank" rel="external">http://www.kanyinqing.com/read/it/other/445654.html</a></p>
<p>原文链接: <a href="http://blog.csdn.net/zhz459880251/article/details/50615503" target="_blank" rel="external">http://blog.csdn.net/zhz459880251/article/details/50615503</a></p>
</li>
</ol>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="zhzDeveloper.github.io/2016/01/31/第三方SSKeychain保存用户密码/" data-id="cj3uzbmf3003wxzhlu9vqs9bc" class="article-share-link">分享</a><div class="tags"></div><div class="post-nav"><a href="/2016/02/27/NSArray+Addition/" class="pre">NSArray+Addition</a><a href="/2016/01/24/升级XCode后点击没打开界面的原因/" class="next">升级XCode后点击没打开界面的原因</a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="zhzDeveloper.github.io"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS-分类/">iOS-分类</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ios平台/">ios平台</a><span class="category-list-count">65</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ios平台-UI控件/">ios平台,UI控件</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ios平台-图片处理/">ios平台,图片处理</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ios平台-开发工具/">ios平台,开发工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/swift/">swift</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发工具/">开发工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/正则/">正则</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机技巧/">计算机技巧</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/02/13/Python 爬虫初探/">Python 爬虫初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/12/数组排序sortedArrayUsingComparator/">数组排序sortedArrayUsingComparator</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/13/macOS Sierra 找回消失的 “任何来源”/">macOS Sierra 找回消失的 “任何来源”</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/11/Method Swizzling(转载+补充)/">Method Swizzling(转载+补充)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/10/instancesRespondToSelector与respondsToSelector的区别/">instancesRespondToSelector与respondsToSelector的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/08/生成Description/">生成Description</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/26/忽略编译警告/">忽略编译警告</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/09/iOS-面试题整理/">iOS-面试题整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/07/GCD小结/">GCD小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/04/iOS- 响应者链, runtime, runloop/">iOS- 响应者链, runtime, runloop</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">zhz blogs.</a> Powered by<a rel="nofollow" target="_blank" href="https://github.com/zhzDeveloper"> zhz.</a><a rel="nofollow" target="_blank" href="http://zhzdeveloper.github.io/"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/zhzDeveloper"> zhz.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>